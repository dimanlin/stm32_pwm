#include "stm32f10x.h"

int main() {
 /*????????????? GPIOA.
  ????? PA1 ????????????? ??? ?????? ? ??????? TIM2_CH2*/
  RCC->APB2ENR |= (RCC_APB2ENR_IOPAEN | RCC_APB2ENR_AFIOEN); //???????????? ????? GPIOA ? ?????????????? ???????
  GPIOA->CRL |= GPIO_CRL_MODE1;//???????????? ???????? ????? = 50 MHz
  GPIOA->CRL &= ~GPIO_CRL_CNF1;//??????? ??? CNF[1:0] ??? PA1 (????????? ????? ?????? ?? ????? ????? "Input Floating")
  GPIOA->CRL |= GPIO_CRL_CNF1_1; //PA1 - ????? Push-Pull ? ?????? ?????????????? ???????

  /*????????????? ??????? TIM2
  ??? ???????????? ??????? ??? ???????????? ????? 2 (TIM2_CH2)*/
  RCC->APB1ENR |= RCC_APB1ENR_TIM2EN;//???????????? ??????? TIM2
  TIM2->CR1 |= TIM_CR1_ARPE;//??????? ????? ??????????????? ?????? ???????? ????????????????
  TIM2->CCMR1 |= TIM_CCMR1_OC2PE;//??????? ????? ??????????????? ???????? ???????? ?????????
  TIM2->CCMR1 |= (TIM_CCMR1_OC2M_2 | TIM_CCMR1_OC2M_1);//OC2M = 110 - PWM mode 1
  TIM2->ARR = 23999;//?????? ????????? ??????? T = 1mS
  TIM2->CCR2 = 19200;//???????????? ????????. ? ?????? ?????? Duty cycle = 80%
  //TIM2->CCER |= TIM_CCER_CC2P;//?????????? ????????? ???????
  TIM2->CCER |= TIM_CCER_CC2E;//????? ?????? ???????/????????? ???????
  TIM2->CR1 |= TIM_CR1_CEN;//????? ????? ???????

  while(1);
}